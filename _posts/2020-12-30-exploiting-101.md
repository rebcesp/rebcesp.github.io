---
layout: post
title: Exploiting 101/Parte 1
category: exploit,asm,programming
permalink: "blog/exploiting-101"
published: yes
---

# Parte 0x01

* Exploit: Programa o código que se `aprovecha un agujero de seguridad(vulnerabilidad)` en una aplicación o sistema, de forma que un atacante podría usarla en su beneficio.

El entorno donde se crearán los exploits y se verán ejecución será en un sistema operativo GNU/Linux de 32 bits. En esta ocasión usare una distro de Debian 10 Buster de 32 bits, virtualizado con todas las mitigaciones deshabilitadas. Vamos a ir viendo como configurar para habilitar y deshabilitar estas protecciones en un sistema `GNU/Linux`.

Para comenzar con los exploits básicos es necesario, pero a medidad que se profundiza en técnicas de ataque más avanzadas se procede a deshabilitar las mitigaciones.

Necesitaremos instalar herramientas de analisis de binarios y debugging

## Configuraciones Mitigaciones / Herramientas de Análisis

A la hora de introducirse en el tema, es recomendable deshabilitar las técnicas de mitigación presentes por defecto en los sistemas modernos. A medida que se avanza con ataques más sofisticados es posible habilitar una a una estas mitigaciones para poner en práctica como subvertirlas y trabajar en el marco de escenarios mas `"reales"`. Por lo tanto se reocmienda compilar los programas vulnerables con ciertos flags específicos que harán la tarea más fácil y se recomiendan ciertas configuraciones extras en el sistema.

## Entorno sin mitigaciones

Por ejemplo si hablamos de desbordamiento de búfer(overflow) es una vulnerabilidad de larga data, los sistemas operativos desarrollaron prevenciones para este tipo de ataques, entre otras la randomización de espacio de direcciones y la implementación de `canaries` de protección de pila. Por eso para introducir estos ataques es necesario deshabilitar una serie de configuraciones para, en segunda instancia, explicar cómo superarlas. A continuación se hace un repaso de las mitigaciones y se usa el script `checksec` para detectar cuando se encuentran habilitadas o no

## ASLR 
El ASLR("Address Space Layout Randomization" o mapa de espacio de direciones aleatorio) es una tecnología diseñada para impedir la explotación de ciertas vulnerabilidades. El ASLR vuelve aleaotrias las direcciones de memoria de un proceso y por ende, dificulta la tarea de adivinar direcciones de la pila. Esta información es necesaria para la lectura y reescritura de sectores claves de la pila, para la inyección y ejecución de código malicioso y en el caso de técnicas de explotación más avanzadas, para la creación de `ROP gadgets`.

Para desactivar temporalmente esta protección desde la terminal es configuración el espacio de memoria como `no random`

```bash
rebcesp@rebcesp:~$ sudo sysctl -w kernel.randomize_va_space=0 #no random
rebcesp@rebcesp:~$ sudo sysctl -w kernel.randomize_va_space=1 #random
#Comprobamos que este en 0
rebcesp@rebcesp:~$ cat /proc/sys/kernel/randomize_va_space
0
```
## Mitigación W^X
Es una política en relación a la memoria que indica

